<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mindful Finance Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #F9F7F2; -webkit-tap-highlight-color: transparent; }
        .card { background-color: #FFFFFF; border-radius: 20px; border: 1px solid #E5E2D9; }
        .btn-primary { background-color: #7DA67D; color: white; border-radius: 14px; }
        .accent-text { color: #5B7A5B; }
        .tab { padding: 8px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; cursor: pointer; background: #F0EEE6; color: #8A877F; white-space: nowrap; }
        .tab.active { background: #7DA67D; color: white; }
        .cat-badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: bold; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .progress-bar { height: 6px; border-radius: 3px; background: #E5E2D9; overflow: hidden; }
        .progress-fill { height: 100%; background: #7DA67D; transition: width 0.5s ease; }
    </style>
</head>
<body class="p-4 font-sans text-slate-800">
    <div class="max-w-md mx-auto">
        
        <header class="mb-6 text-center pt-4">
            <h1 class="text-[10px] uppercase tracking-[0.2em] text-stone-400 font-bold mb-1">Estimated Net Worth</h1>
            <div id="net-worth" class="text-4xl font-light accent-text">£0.00</div>
            <div id="monthly-stats" class="flex justify-center gap-4 mt-2 text-[11px] font-bold">
                <span id="stat-in" class="text-green-600">IN: £0.00</span>
                <span id="stat-out" class="text-red-400">OUT: £0.00</span>
            </div>
        </header>

        <div class="card p-4 mb-6 shadow-sm">
            <canvas id="spendChart" style="max-height: 180px; margin-bottom: 15px;"></canvas>
            <div class="px-2">
                <div class="flex justify-between text-[10px] uppercase font-bold text-stone-400 mb-1">
                    <span>Monthly Budget Usage</span>
                    <span id="budget-percent">0%</span>
                </div>
                <div class="progress-bar">
                    <div id="budget-fill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div id="account-grid" class="grid grid-cols-2 gap-2 mb-6 text-center text-stone-700"></div>

        <div class="card p-5 mb-6 shadow-sm">
            <div class="flex gap-2 overflow-x-auto pb-3 mb-3 no-scrollbar" id="cat-selector"></div>
            
            <div class="space-y-3">
                <div class="flex bg-stone-100 p-1 rounded-xl">
                    <button onclick="setType('out')" id="tgl-out" class="flex-1 py-2 rounded-lg text-xs font-bold transition bg-white shadow-sm text-red-500">EXPENSE</button>
                    <button onclick="setType('in')" id="tgl-in" class="flex-1 py-2 rounded-lg text-xs font-bold transition text-stone-400">INCOME</button>
                </div>

                <input id="desc" type="text" placeholder="Description" class="w-full bg-stone-50 p-3 rounded-xl outline-none border border-stone-100 focus:border-green-300">
                <div class="flex gap-2">
                    <input id="amt" type="number" inputmode="decimal" placeholder="0.00" class="w-full bg-stone-50 p-3 rounded-xl outline-none border border-stone-100 text-lg">
                    <button onclick="addEntry()" id="add-btn" class="btn-primary px-6 font-bold shadow-md active:scale-95 transition">Add</button>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-center mb-3 px-1">
            <h2 class="text-sm font-bold text-stone-500 uppercase tracking-tight">Recent Activity</h2>
            <button onclick="exportCSV()" class="text-[10px] font-bold text-stone-400 border border-stone-200 px-3 py-1 rounded-full uppercase">CSV</button>
        </div>
        <ul id="list" class="space-y-2 pb-10"></ul>

        <button onclick="resetData()" class="w-full text-[10px] text-stone-300 py-4 uppercase tracking-widest">Wipe All Data</button>
    </div>

    <script>
        let currentCat = 'Misc';
        let currentType = 'out';
        let chartInstance = null;

        const CONFIG = {
            categories: ['Housing', 'Transport', 'Food', 'Ent', 'Savings', 'Misc'],
            monthlyBudget: 2000, // Change this to your monthly goal
            base: { savings: 40606, pension: 37122, debt: -16107 }
        };

        function setCat(cat) {
            currentCat = cat;
            renderTabs();
        }

        function setType(type) {
            currentType = type;
            const btnIn = document.getElementById('tgl-in');
            const btnOut = document.getElementById('tgl-out');
            const addBtn = document.getElementById('add-btn');

            if(type === 'in') {
                btnIn.className = "flex-1 py-2 rounded-lg text-xs font-bold transition bg-white shadow-sm text-green-600";
                btnOut.className = "flex-1 py-2 rounded-lg text-xs font-bold transition text-stone-400";
                addBtn.style.backgroundColor = "#7DA67D";
            } else {
                btnOut.className = "flex-1 py-2 rounded-lg text-xs font-bold transition bg-white shadow-sm text-red-500";
                btnIn.className = "flex-1 py-2 rounded-lg text-xs font-bold transition text-stone-400";
                addBtn.style.backgroundColor = "#A67D7D";
            }
        }

        function renderTabs() {
            const container = document.getElementById('cat-selector');
            container.innerHTML = CONFIG.categories.map(c => 
                `<div class="tab ${currentCat === c ? 'active' : ''}" onclick="setCat('${c}')">${c}</div>`
            ).join('');
        }

        async function load() {
            const data = await localforage.getItem('finance_v2') || [];
            const grid = document.getElementById('account-grid');
            const list = document.getElementById('list');
            
            let totalIn = 0;
            let totalOut = 0;
            const catTotals = {};

            data.forEach(e => {
                const val = parseFloat(e.amt);
                if(e.type === 'in') {
                    totalIn += val;
                } else {
                    totalOut += val;
                    catTotals[e.cat] = (catTotals[e.cat] || 0) + val;
                }
            });

            // Update UI
            const netVal = CONFIG.base.savings + CONFIG.base.pension + CONFIG.base.debt + totalIn - totalOut;
            document.getElementById('net-worth').innerText = `£${netVal.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('stat-in').innerText = `IN: £${totalIn.toLocaleString()}`;
            document.getElementById('stat-out').innerText = `OUT: £${totalOut.toLocaleString()}`;

            // Update Budget Progress
            const budgetPercent = Math.min((totalOut / CONFIG.monthlyBudget) * 100, 100);
            document.getElementById('budget-fill').style.width = budgetPercent + '%';
            document.getElementById('budget-percent').innerText = Math.round(budgetPercent) + '%';
            document.getElementById('budget-fill').style.backgroundColor = budgetPercent > 90 ? '#A67D7D' : '#7DA67D';

            grid.innerHTML = `
                <div class="card p-3"><p class="text-[9px] uppercase text-stone-400">Savings</p><p class="text-sm font-bold">£${CONFIG.base.savings.toLocaleString()}</p></div>
                <div class="card p-3"><p class="text-[9px] uppercase text-stone-400">Pension</p><p class="text-sm font-bold">£${CONFIG.base.pension.toLocaleString()}</p></div>
                <div class="card p-3"><p class="text-[9px] uppercase text-stone-400">Debt</p><p class="text-sm font-bold text-red-400">£${CONFIG.base.debt.toLocaleString()}</p></div>
                <div class="card p-3 bg-stone-50"><p class="text-[9px] uppercase text-stone-400">Cash Flow</p><p class="text-sm font-bold ${totalIn - totalOut >= 0 ? 'text-green-600' : 'text-red-400'}">£${(totalIn - totalOut).toFixed(0)}</p></div>
            `;

            list.innerHTML = data.slice().reverse().map((e, idx) => `
                <li class="flex justify-between items-center p-4 card shadow-sm">
                    <div>
                        <p class="text-sm font-semibold text-stone-700">${e.desc}</p>
                        <span class="cat-badge ${e.type === 'in' ? 'bg-green-100 text-green-700' : 'bg-stone-100 text-stone-500'}">${e.cat}</span>
                    </div>
                    <div class="text-right">
                        <p class="font-bold ${e.type === 'in' ? 'text-green-600' : 'text-stone-700'}">${e.type === 'in' ? '+' : '-'}£${parseFloat(e.amt).toFixed(2)}</p>
                        <button onclick="deleteEntry(${data.length - 1 - idx})" class="text-[10px] text-stone-300">Delete</button>
                    </div>
                </li>
            `).join('');

            updateChart(catTotals);
        }

        function updateChart(catTotals) {
            const ctx = document.getElementById('spendChart').getContext('2d');
            const labels = Object.keys(catTotals);
            const values = Object.values(catTotals);

            if (chartInstance) chartInstance.destroy();
            if (labels.length === 0) return; // Don't render if empty
            
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: ['#7DA67D', '#9DBE9D', '#C2D6C2', '#E5E2D9', '#8A877F', '#A67D7D'],
                        borderWidth: 0
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'right', labels: { boxWidth: 10, font: { size: 9 } } } 
                    },
                    cutout: '75%'
                }
            });
        }

        async function addEntry() {
            const desc = document.getElementById('desc').value;
            const amt = document.getElementById('amt').value;
            if(!desc || !amt) return;

            const data = await localforage.getItem('finance_v2') || [];
            data.push({ desc, amt: Math.abs(parseFloat(amt)), cat: currentCat, type: currentType, date: new Date().toISOString() });
            await localforage.setItem('finance_v2', data);
            
            document.getElementById('desc').value = '';
            document.getElementById('amt').value = '';
            load();
        }

        async function deleteEntry(idx) {
            const data = await localforage.getItem('finance_v2') || [];
            data.splice(idx, 1);
            await localforage.setItem('finance_v2', data);
            load();
        }

        async function exportCSV() {
            const data = await localforage.getItem('finance_v2') || [];
            let csv = "Date,Type,Category,Description,Amount\n" + data.map(e => `${e.date},${e.type},${e.cat},${e.desc},${e.amt}`).join("\n");
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `finance_export.csv`; a.click();
        }

        async function resetData() { if(confirm("Wipe all data?")) { await localforage.clear(); load(); } }

        renderTabs();
        load();
    </script>
</body>
</html>
